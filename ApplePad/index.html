<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SketchSense – Stroke & Geometry</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #eee;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }

    h1 {
      margin: 16px 0 4px;
      font-size: 20px;
      font-weight: 600;
    }

    #stepIndicator {
      margin-bottom: 12px;
      font-size: 14px;
      color: #bbb;
    }

    #mainLayout {
      display: flex;
      gap: 24px;
      padding: 16px;
      max-width: 1000px;
      width: 100%;
      box-sizing: border-box;
    }

    #canvasContainer {
      flex: 2;
      border: 1px solid #333;
      border-radius: 8px;
      overflow: hidden;
      background: #111;
    }

    #controlsContainer select {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: #eee;
      font-size: 13px;
    }


    #demographicsPanel select {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: #eee;
    }

    .panel {
      border-radius: 8px;
      padding: 12px;
      background: #1a1a1a;
      border: 1px solid #333;
    }

    .panel h2, .panel h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }

    .sliderRow {
      margin: 8px 0;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .sliderRow label {
      display: flex;
      justify-content: space-between;
    }

    .sliderRow span.value {
      color: #aaa;
    }

    /* NEW: for the dual-end labels */
    .dualLabel {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: #bbb;
      margin-bottom: 2px;
    }

    input[type="range"] {
      width: 100%;
    }

    #navButtons {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      gap: 8px;
    }

    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      background: #2d2d2d;
      color: #f5f5f5;
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    button#btnNext {
      background: #3c82f6;
    }

    #message {
      margin-top: 8px;
      font-size: 12px;
      color: #aaa;
      min-height: 16px;
    }

    /* Tag selection styles */
    .tag-checkbox {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #1a1a1a;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
    }

    .tag-checkbox:hover {
      border-color: #666;
      background: #222;
    }

    .tag-checkbox input[type="checkbox"] {
      margin-right: 8px;
      cursor: pointer;
    }

    .tag-checkbox input[type="checkbox"]:checked + span {
      color: #3c82f6;
      font-weight: 500;
    }

    .tag-checkbox:has(input:checked) {
      border-color: #3c82f6;
      background: #1a2532;
    }

    .style-option:hover {
      border-color: #3c82f6 !important;
      background: #222 !important;
      transform: scale(1.02);
    }

    .style-option.selected {
      border-color: #3c82f6 !important;
      background: #1a2532 !important;
    }
  </style>
</head>
<body>
  <h1>SketchSense</h1>

  <!-- =========================
       SCREEN 0: Launch page
       ========================= -->
  <div id="launchScreen">
    <div id="mainLayout">
      <div id="launchContainer">
        <div class="panel" style="max-width: 600px; margin: 0 auto; text-align: center;">
          <h2 style="font-size: 18px; margin-bottom: 16px;">Welcome to SketchSense</h2>
          <p style="font-size: 14px; line-height: 1.6; color: #ccc; margin-bottom: 20px;">
            This study explores how your hand sketch preferences relate to your interior design taste. 
            You'll adjust various visual parameters through an interactive apple sketch across 3 steps, 
            and we'll generate a personalized living room design based on your choices.
          </p>
          <p style="font-size: 14px; line-height: 1.6; color: #ccc; margin-bottom: 24px;">
            <strong>What you'll do:</strong><br>
            1. Provide basic demographic information<br>
            2. Adjust stroke, geometry, and color parameters (3 steps)<br>
            3. View your personalized interior design
          </p>
          <p style="font-size: 13px; color: #aaa; margin-bottom: 24px;">
            Estimated time: 5-10 minutes
          </p>
          <button id="btnLaunchOk" style="padding: 10px 32px; font-size: 14px;">OK, Let's Start</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       SCREEN A: Demographic page
       ========================= -->
  <div id="demoScreen" style="display:none;">
    <div id="mainLayout">
      <div id="demoCanvasContainer">
        <div class="panel">
          <h2>Before we start</h2>

          <div class="sliderRow">
            <label for="username">
              Username
            </label>
            <input 
              type="text" 
              id="username" 
              placeholder="Enter your username" 
              style="width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #444; background: #111; color: #eee; font-size: 13px;"
            />
          </div>

          <div class="sliderRow">
            <label for="ageRange">
              Age range
            </label>
            <select id="ageRange">
              <option value="">-- select --</option>
              <option value="18-24">18–24</option>
              <option value="25-34">25–34</option>
              <option value="35-44">35–44</option>
              <option value="45-54">45–54</option>
              <option value="55-64">55–64</option>
              <option value="65+">65+</option>
            </select>
          </div>

          <div class="sliderRow">
            <label for="gender">
              Gender
            </label>
            <select id="gender">
              <option value="">-- select --</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
              <option value="non-binary">Non-binary</option>
              <option value="prefer-not">Prefer not to say</option>
            </select>
          </div>

          <div class="sliderRow">
            <label for="eduBackground">
              Education background
            </label>
            <select id="eduBackground">
              <option value="">-- select --</option>
              <option value="art-design-arch">Art / Design </option>
              <option value="eng-tech-cs">Engineering / Technology / Computer Science</option>
              <option value="natural-math">Natural Sciences / Mathematics</option>
              <option value="social-humanities">Social Sciences / Humanities</option>
              <option value="business-econ">Business / Economics / Management</option>
              <option value="health-med">Health / Medicine</option>
              <option value="other">Other / Mixed background</option>
            </select>
          </div>

          <button id="btnDemoStart">Start</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       SCREEN B: Tag Selection
       ========================= -->
  <div id="tagScreen" style="display:none;">
    <div id="mainLayout">
      <div id="tagContainer">
        <div class="panel" style="max-width: 700px; margin: 0 auto;">
          <h2>What's your style preference?</h2>
          <p style="font-size: 14px; color: #ccc; margin-bottom: 20px;">
            Based on your current imagination and understanding, select <strong>2 interior design styles</strong> that match your preferences:
          </p>
          
          <div id="tagSelection" style="margin-bottom: 24px;">
            <!-- Tags will be arranged in a grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px;">
              <label class="tag-checkbox">
                <input type="checkbox" value="Ultra Minimal" class="preference-tag">
                <span>Ultra Minimal</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Scandinavian" class="preference-tag">
                <span>Scandinavian</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Japandi" class="preference-tag">
                <span>Japandi</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Contemporary Calm" class="preference-tag">
                <span>Contemporary Calm</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Retro modern" class="preference-tag">
                <span>Retro modern</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Timeless Farmhouse" class="preference-tag">
                <span>Timeless Farmhouse</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Vintage Industrial" class="preference-tag">
                <span>Vintage Industrial</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Cabin Chic" class="preference-tag">
                <span>Cabin Chic</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Eclectic Boho" class="preference-tag">
                <span>Eclectic Boho</span>
              </label>
              <label class="tag-checkbox">
                <input type="checkbox" value="Modern Deco" class="preference-tag">
                <span>Modern Deco</span>
              </label>
            </div>
          </div>
          
          <div style="margin-bottom: 16px; padding: 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 6px;">
            <label style="display: flex; align-items: center; cursor: pointer; font-size: 13px;">
              <input type="checkbox" id="styleUnclear" style="margin-right: 8px; cursor: pointer;">
              <span>It is hard to understand the meaning of each style listed.</span>
            </label>
          </div>
          
          <p style="font-size: 12px; color: #aaa; margin-bottom: 16px;">
            Select exactly 2 styles to continue (or check the option above if unclear)
          </p>
          
          <button id="btnTagContinue">Continue to Sketch</button>
        </div>
      </div>
    </div>
  </div>

    <!-- ======================
       SCREEN C: Trial steps
       ====================== -->
  <div id="trialScreen" style="display:none;">
    <div id="stepIndicator">Step 1 / 3: Stroke Character</div>

    <div id="mainLayout">
      <!-- LEFT: drawing + buttons + generated image -->
      <div id="canvasContainer">
        <!-- STEP 1 panel -->
        <div id="step1Controls" class="panel">
          <h2>Step 1 – Stroke Character</h2>

          <div class="sliderRow">
            <label for="strokeThickness">
              Thickness
              <span class="value" id="val_strokeThickness">3.0</span>
            </label>
            <input type="range" id="strokeThickness" min="0.5" max="12" step="0.5" value="2">
          </div>

          <div class="sliderRow">
            <label for="strokeCoarseness">
              Coarseness
              <span class="value" id="val_strokeCoarseness">0.0</span>
            </label>
            <input type="range" id="strokeCoarseness" min="0" max="100" step="1" value="0">
          </div>

          <div class="sliderRow">
            <label for="strokeWiggle">
              Wiggleness
              <span class="value" id="val_strokeWiggle">0.00</span>
            </label>
            <input type="range" id="strokeWiggle" min="0" max="100" step="1" value="0">
          </div>
        </div>

        <!-- STEP 2 panel -->
        <div id="step2Controls" class="panel" style="display:none;">
          <h2>Step 2 – Apple Geometry</h2>

          <div class="sliderRow">
            <label for="appleMorph">
              Bumpiness
              <span class="value" id="val_appleMorph">0.50</span>
            </label>
            <input type="range" id="appleMorph" min="0" max="100" step="1" value="50">
          </div>

          <div class="sliderRow">
            <label for="appleRigidity">
              Rigidity
              <span class="value" id="val_appleRigidity">0.50</span>
            </label>
            <input type="range" id="appleRigidity" min="0" max="100" step="1" value="50">
          </div>

          <div class="sliderRow">
            <label for="appleSymmetry">
              Symmetry
              <span class="value" id="val_appleSymmetry">0.00</span>
            </label>
            <input type="range" id="appleSymmetry" min="0" max="100" step="1" value="0">
          </div>
        </div>

        <!-- STEP 3 panel -->
        <div id="step3Controls" class="panel" style="display:none;">
          <h2>Step 3: Color Palette</h2>

          <div class="sliderRow">
            <label for="colorTone" class="dualLabel">
              <span>Warm</span>
              <span>Cold</span>
            </label>
            <input
              type="range"
              id="colorTone"
              min="0"
              max="100"
              value="50"
              step="1"
            />
          </div>

          <div class="sliderRow">
            <label for="colorSaturation" class="dualLabel">
              <span>Muted</span>
              <span>Vivid</span>
            </label>
            <input
              type="range"
              id="colorSaturation"
              min="0"
              max="100"
              value="80"
              step="1"
            />
          </div>

          <div class="sliderRow">
            <label for="colorBrightness" class="dualLabel">
              <span>Dull</span>
              <span>Bright</span>
            </label>
            <input
              type="range"
              id="colorBrightness"
              min="0"
              max="100"
              value="50"
              step="1"
            />
          </div>

          <div class="sliderRow">
            <label for="colorVariation" class="dualLabel">
              <span>Uniform</span>
              <span>Diverse</span>
            </label>
            <input
              type="range"
              id="colorVariation"
              min="0"
              max="100"
              value="50"
              step="1"
            />
          </div>
        </div>

        <div id="navButtons">
          <button id="btnBack" disabled>Back</button>
          <button id="btnNext">Next</button>
          <button id="btnIterate" style="display:none;">Generate Refined Design</button>
        </div>
      </div>

      <!-- RIGHT: controls container (evaluation removed - now in result screen) -->
      <div id="controlsContainer">
      </div>
    </div>
  </div>

  <!-- =========================
       SCREEN D: Style Choice
       ========================= -->
  <div id="styleChoiceScreen" style="display:none;">
    <div id="mainLayout">
      <div style="max-width: 800px; margin: 0 auto;">
        <div class="panel">
          <h2>Choose Your Style</h2>
          <p style="font-size: 14px; color: #ccc; margin-bottom: 24px;">
            Based on your sketch, we've identified two styles that match your preferences. 
            Select one to generate your personalized living room design:
          </p>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
            <div id="styleOption1" class="style-option" style="cursor: pointer; border: 2px solid #444; border-radius: 8px; padding: 0; background: #1a1a1a; transition: all 0.2s; overflow: hidden;">
              <img id="styleImage1" src="" alt="Style 1" style="width: 100%; height: 250px; object-fit: cover; display: block;">
              <div style="padding: 16px;">
                <h3 id="styleName1" style="margin: 0 0 8px 0; font-size: 16px;">Style 1</h3>
                <p id="styleDesc1" style="font-size: 13px; color: #aaa; margin: 0;">Description</p>
              </div>
            </div>
            <div id="styleOption2" class="style-option" style="cursor: pointer; border: 2px solid #444; border-radius: 8px; padding: 0; background: #1a1a1a; transition: all 0.2s; overflow: hidden;">
              <img id="styleImage2" src="" alt="Style 2" style="width: 100%; height: 250px; object-fit: cover; display: block;">
              <div style="padding: 16px;">
                <h3 id="styleName2" style="margin: 0 0 8px 0; font-size: 16px;">Style 2</h3>
                <p id="styleDesc2" style="font-size: 13px; color: #aaa; margin: 0;">Description</p>
              </div>
            </div>
          </div>
          
          <p id="styleChoiceMessage" style="font-size: 12px; color: #aaa; text-align: center;">
            Click on a style to select it
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ======================
       SCREEN E: Result & Evaluation
       ====================== -->
  <div id="resultScreen" style="display:none;">
    <div id="resultLayout">
      <!-- Message -->
      <div id="message" style="margin-bottom: 16px; font-size: 13px; color: #ccc;"></div>
      
      <!-- Two-column layout: Image on left, Description+Tags on right -->
      <div style="display: flex; gap: 24px; margin-bottom: 24px;">
        <!-- Left: Generated Image + Rate Button -->
        <div style="flex: 1; display: flex; flex-direction: column;">
          <div id="generatedImageContainer" style="display: none;">
            <img id="generatedImage" style="width: 100%; border: 1px solid #444; border-radius: 4px;" />
          </div>
          <button id="btnShowEvaluation" style="margin-top: 16px; display: none;">Rate the Design</button>
        </div>
        
        <!-- Right: Tags and Description -->
        <div style="flex: 1; display: flex; flex-direction: column; gap: 16px;">
          <!-- Tags Used -->
          <div id="generatedTagsContainer" style="padding: 16px; background: #1a1a1a; border: 1px solid #444; border-radius: 6px; display: none;">
            <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #fff;">Design Highlights</h3>
            
            <!-- Apple Drawing -->
            <div id="appleImageContainer" style="margin-bottom: 16px; text-align: center; display: none;">
              <img id="appleImage" style="max-width: 100%; border: 1px solid #555; border-radius: 4px; background: #2a2a2a;" />
            </div>
            
            <!-- Parameter Sliders -->
            <div id="generatedTags" style="font-size: 13px;"></div>
          </div>
          
          <!-- Text Description -->
          <div id="generatedDescriptionContainer" style="padding: 16px; background: #1a1a1a; border: 1px solid #444; border-radius: 6px; display: none;">
            <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #fff;">Design Description</h3>
            <p id="generatedDescription" style="font-size: 14px; line-height: 1.6; color: #ddd; margin: 0; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;"></p>
            <button id="btnReadMore" style="margin-top: 12px; padding: 6px 12px; background: #333; border: 1px solid #555; color: #fff; border-radius: 4px; cursor: pointer; font-size: 13px; display: none;">Read More</button>
          </div>
          
          <!-- Evaluation Questions (shown in place of description) -->
          <div id="resultEvaluationContainer" style="padding: 16px; background: #1a1a1a; border: 1px solid #444; border-radius: 6px; display: none;">
            <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #fff;">Evaluate the Generated Design</h3>
            <p style="font-size: 13px; color: #ccc; margin-bottom: 16px;">
              Please rate how well this design matches your preferences:
            </p>

            <div class="sliderRow">
              <label>1. Materials and textures match my taste.</label>
              <select id="q_materials">
                <option value="">-- select --</option>
                <option value="1">1 – Strongly disagree</option>
                <option value="2">2 – Disagree</option>
                <option value="3">3 – Neutral</option>
                <option value="4">4 – Agree</option>
                <option value="5">5 – Strongly agree</option>
              </select>
            </div>

            <div class="sliderRow">
              <label>2. The spatial arrangement feels right to me.</label>
              <select id="q_spatial">
                <option value="">-- select --</option>
                <option value="1">1 – Strongly disagree</option>
                <option value="2">2 – Disagree</option>
                <option value="3">3 – Neutral</option>
                <option value="4">4 – Agree</option>
                <option value="5">5 – Strongly agree</option>
              </select>
            </div>

            <div class="sliderRow">
              <label>3. The color palette matches what I like.</label>
              <select id="q_color">
                <option value="">-- select --</option>
                <option value="1">1 – Strongly disagree</option>
                <option value="2">2 – Disagree</option>
                <option value="3">3 – Neutral</option>
                <option value="4">4 – Agree</option>
                <option value="5">5 – Strongly agree</option>
              </select>
            </div>

            <div class="sliderRow">
              <label>4. Overall, this room matches my personal style.</label>
              <select id="q_overall">
                <option value="">-- select --</option>
                <option value="1">1 – Strongly disagree</option>
                <option value="2">2 – Disagree</option>
                <option value="3">3 – Neutral</option>
                <option value="4">4 – Agree</option>
                <option value="5">5 – Strongly agree</option>
              </select>
            </div>

            <div class="sliderRow">
              <label>5. This drawing-based method helped me discover my preferences.</label>
              <select id="q_method">
                <option value="">-- select --</option>
                <option value="1">1 – Strongly disagree</option>
                <option value="2">2 – Disagree</option>
                <option value="3">3 – Neutral</option>
                <option value="4">4 – Agree</option>
                <option value="5">5 – Strongly agree</option>
              </select>
            </div>

            <button id="btnSubmitEvaluation" style="margin-top: 20px;">Submit Evaluation</button>
          </div>
          
          <!-- Refinement Selection (shown after evaluation) -->
          <div id="refinementContainer" style="padding: 16px; background: #1a1a1a; border: 1px solid #444; border-radius: 6px; display: none;">
            <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #fff;">Refine Your Design</h3>
            <p style="font-size: 13px; color: #ccc; margin-bottom: 16px;">
              Please pick one aspect of the following you would like to refine:
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <button class="refinement-option" data-refinement="material" style="padding: 12px; background: #2a2a2a; border: 2px solid #444; color: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; text-align: left; transition: all 0.2s;">
                Material Quality
              </button>
              <button class="refinement-option" data-refinement="spatial" style="padding: 12px; background: #2a2a2a; border: 2px solid #444; color: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; text-align: left; transition: all 0.2s;">
                Spatial Organization
              </button>
              <button class="refinement-option" data-refinement="color" style="padding: 12px; background: #2a2a2a; border: 2px solid #444; color: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; text-align: left; transition: all 0.2s;">
                Color
              </button>
              <button class="refinement-option" data-refinement="none" style="padding: 12px; background: #2a2a2a; border: 2px solid #444; color: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; text-align: left; transition: all 0.2s;">
                I like the design and would not refine anything
              </button>
            </div>
            
            <div id="thankYouMessage" style="display: none; margin-top: 20px; padding: 16px; background: #1a4d1a; border: 1px solid #2d7a2d; border-radius: 6px; text-align: center;">
              <h3 style="margin: 0 0 8px 0; color: #6dff6d;">Thank You!</h3>
              <p style="margin: 0; color: #ddd;">Your responses have been recorded. You may close this window.</p>
            </div>
          </div>
    </div>
  </div>

</div>


  <!-- p5.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <!-- your sketch -->
  <script src="promptUtils.js"></script>
  <script src="imageApi.js"></script>
  <script src="sketch.js"></script>

</html>


